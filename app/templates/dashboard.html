{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<style>
  .metrics-grid {
    align-items: stretch;
  }
  .metric-card {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 116px;
    margin: 0 !important;
  }
  .metric-label {
    min-height: 22px;
    display: flex;
    align-items: center;
  }
  .metric-value {
    min-height: 42px;
    display: flex;
    align-items: flex-end;
  }
</style>
<div class="grid cols-4 metrics-grid">
  <div class="card metric-card"><div class="muted metric-label">Toplam Ajan</div><div class="metric metric-value" id="m-total-agents">-</div></div>
  <div class="card metric-card"><div class="muted metric-label">Online</div><div class="metric metric-value" id="m-online">-</div></div>
  <div class="card metric-card"><div class="muted metric-label">Uygulamalar</div><div class="metric metric-value" id="m-apps">-</div></div>
  <div class="card metric-card"><div class="muted metric-label">Dagitimlar</div><div class="metric metric-value" id="m-deployments">-</div></div>
</div>
<div class="card">
  <div class="row spread wrap">
    <h3 style="margin: 0;">Hizli Durum</h3>
    <button class="btn secondary" onclick="loadDashboard()">Yenile</button>
  </div>
  <p class="muted">Bu ekran 10 saniyede bir otomatik yenilenir.</p>
</div>
{% endblock %}
{% block scripts %}
<script>
  AppCenterApi.protectPage();

  async function loadDashboard() {
    try {
      const stats = await AppCenterApi.req('/dashboard/stats');
      document.getElementById('m-total-agents').textContent = stats.total_agents;
      document.getElementById('m-online').textContent = stats.online_agents;
      document.getElementById('m-apps').textContent = stats.total_applications;
      document.getElementById('m-deployments').textContent = stats.active_deployments;
    } catch (err) {
      AppCenterApi.toast(err.message);
    }
  }

  loadDashboard();
  setInterval(loadDashboard, 10000);
</script>
{% endblock %}
